<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CMS</title>
  <style>
    /* Isolated container to prevent external interference */
    #cms-container {
      position: relative;
      z-index: 1;
      min-height: 100vh;
    }
  </style>
  <!-- Preload assets -->
  <link rel="preload" href="https://unpkg.com/decap-cms@^3.0.0/dist/decap-cms.css" as="style">
  <link rel="preload" href="https://unpkg.com/decap-cms@^3.0.0/dist/decap-cms.js" as="script">
</head>
<body>
  <!-- Double-nested container for stability -->
  <div id="cms-container">
    <div id="cms-root"></div>
  </div>

  <!-- Load CSS -->
  <link rel="stylesheet" href="https://unpkg.com/decap-cms@^3.0.0/dist/decap-cms.css">

  <!-- Load JS with defer -->
  <script src="https://unpkg.com/decap-cms@^3.0.0/dist/decap-cms.js" defer></script>

  <!-- Safe initialization -->
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      function initCMS() {
        const container = document.getElementById('cms-container');
        if (!container) {
          console.error('CMS container missing');
          return;
        }

        if (window.CMS) {
          try {
            // Ensure clean slate
            container.innerHTML = '<div id="cms-root"></div>';
            
            CMS.init({
              config: {
                backend: {
                  name: "github",
                  repo: "khaleeqrehman/portfolio-v2",
                  branch: "main"
                },
                media_folder: "static/images/uploads",
                public_folder: "/images/uploads",
                collections: [ /* your collections */ ]
              }
            });
          } catch (e) {
            console.error('CMS initialization failed:', e);
            // Fallback: Reload CMS container
            setTimeout(initCMS, 500);
          }
        } else {
          setTimeout(initCMS, 100);
        }
      }
      initCMS();
    });
  </script>
</body>
</html>